import{a as X,b as Z}from"./chunk-L55BXMNC.js";import{a as re}from"./chunk-OT4H7QKE.js";import{b as ee,c as te,d as ne,e as ie,f as oe}from"./chunk-YFFUOVOG.js";import{b as z,c as C,e as q,f as H,g as $,h as G,j as Q,k as U,l as Y,m as K,n as B,o as J}from"./chunk-6L2DAN5D.js";import"./chunk-4S5XMSU5.js";import"./chunk-DX4FTDQR.js";import{d as L,e as j,h as I,j as W}from"./chunk-X4VVONUQ.js";import{n as A}from"./chunk-6KEO6D2E.js";import{Db as P,Hb as v,Ib as O,K as b,Mb as w,Nb as F,Ob as S,Pb as M,Qb as r,Ra as T,Rb as R,Sb as N,Ta as d,V as y,Zb as D,cb as V,da as x,i as k,ib as u,ja as _,ka as h,qb as E,ub as f,xb as i,yb as e,zb as s}from"./chunk-X3WKPGPN.js";var ce=["dialog"],me=["dialogError"];function de(a,t){a&1&&(i(0,"span"),r(1,"Toque novamente para alterar"),e())}function pe(a,t){a&1&&(i(0,"span",20),r(1,"* Campo Obrigat\xF3rio *"),e())}function ue(a,t){a&1&&(i(0,"span",20),r(1,"Formato de E-mail inv\xE1lido!"),e())}function ge(a,t){a&1&&r(0," * Campo Obrigat\xF3rio * ")}function fe(a,t){a&1&&r(0," CPF invalido * ")}function Ce(a,t){a&1&&s(0,"i",38)}function _e(a,t){a&1&&s(0,"i",39)}function he(a,t){a&1&&r(0," * Campo Obrigat\xF3rio * ")}function ve(a,t){a&1&&r(0," Deve conter pelo menos 6 caracters ")}function Me(a,t){a&1&&s(0,"i",38)}function xe(a,t){a&1&&s(0,"i",39)}function Ee(a,t){a&1&&r(0," * Campo Obrigat\xF3rio * ")}function Pe(a,t){a&1&&r(0," * A senhas devem ser iguais * ")}function Oe(a,t){if(a&1){let l=P();i(0,"div")(1,"div",6),s(2,"img",7),e(),i(3,"h2",44),r(4," Cadastro efetuado com sucesso ! "),e()(),i(5,"mat-dialog-content")(6,"b"),r(7,"Aguarde a aprova\xE7\xE3o do seu cadastro"),e()(),i(8,"mat-dialog-actions")(9,"button",45),v("click",function(){_(l);let c=O();return h(c.closeDialog())}),r(10,"OK"),e()()}}function be(a,t){if(a&1){let l=P();i(0,"div")(1,"div",6),s(2,"img",7),e(),i(3,"h2",44),r(4," Ocorreu um erro ! "),e()(),i(5,"mat-dialog-content")(6,"p"),r(7),e(),i(8,"p"),r(9),e()(),i(10,"mat-dialog-actions",46)(11,"button",47),v("click",function(){_(l);let c=O();return h(c.closeDialog())}),r(12,"OK"),e()()}if(a&2){let l=O();d(7),R(l.errorMessage),d(2),N("C\xF3digo: ",l.statusError,"")}}var ae=class a{templateSucess;templateError;dataService=x(W);dialog=x(ee);router=x(L);fb=x(K);formType=this.fb.control("funcionario");isSubmitting=!1;dialogRef=null;registerForm=this.fb.group({name:["",[C.required,C.minLength(2)]],matricula:[""],birthDay:[""],cpf:["",[C.required,C.minLength(11)]],rg:[""],vinculo:[""],lotacao:[""],endereco:[""],email:["",[C.email]],phone:[""],password:["",[C.required,C.minLength(6)]],confirmPassowrd:["",[C.required]],photo:new $(null),firstAccess:[!1]});profileImg;destroy$=new k;statusError=0;errorMessage="";ngOnInit(){this.registerForm.setValidators(this.passwordMatchValidator)}imgFile(t){let l=t.target;if(l.files&&l.files.length>0){let o=l.files[0];this.registerForm.get("photo")?.setValue(o);let c=new FileReader;c.onload=p=>{this.profileImg=p.target?.result},c.readAsDataURL(o)}}formatDate(t){if(!t)return null;try{let l=new Date(t);return isNaN(l.getTime())?null:l.toISOString().split("T")[0]}catch{return null}}limparCPF(t){return t.replace(/[.-\s]/g,"")}submitForm(){if(this.registerForm.valid&&!this.isSubmitting){this.isSubmitting=!0,console.log("Valores do formul\xE1rio:",this.registerForm.value);let t=new FormData;t.append("name",this.registerForm.get("name")?.value||"");let l=this.registerForm.get("cpf")?.value||"",o=this.limparCPF(l);t.append("cpf",o),t.append("password",this.registerForm.get("password")?.value||""),["matricula","birthDay","rg","vinculo","lotacao","endereco","email","phone"].forEach(n=>{let m=this.registerForm.get(n)?.value;if(m!=null&&m!=="")if(n==="birthDay"&&m){let g=this.formatDate(m);g&&t.append(n,g)}else t.append(n,m)});let p=this.registerForm.get("photo")?.value;p&&t.append("photo",p);for(let n of t.entries())console.log(`${n[0]}: ${n[1]}`);this.dataService.setUser(t).pipe(y(this.destroy$),b(()=>{this.isSubmitting=!1})).subscribe({next:n=>{console.log("Resposta do servidor:",n),n&&n.id?this.updateFirstAccess(n.id):this.openSuccessDialog()},error:n=>{console.error("Erro completo:",n),this.statusError=n.status,n.error&&n.error.message&&n.error.message.includes("User_cpf_key")?this.errorMessage="CPF j\xE1 cadastrado no sistema. Por favor, utilize outro CPF ou entre em contato com o suporte.":this.errorMessage=n.error?.message||"Erro ao cadastrar usu\xE1rio",this.openDialog(this.templateError)}})}else this.isSubmitting||Object.keys(this.registerForm.controls).forEach(t=>{this.registerForm.get(t)?.markAsTouched()})}updateFirstAccess(t){console.log("Atualizando firstAccess para false para usu\xE1rio:",t),this.dataService.updateFirstAccess(t,!1).pipe(y(this.destroy$),b(()=>{this.dialogRef||this.openSuccessDialog()})).subscribe({next:l=>{console.log("FirstAccess atualizado com sucesso:",l),this.openSuccessDialog()},error:l=>{console.error("Erro ao atualizar firstAccess:",l),this.openSuccessDialog()}})}openSuccessDialog(){this.dialogRef=this.dialog.open(this.templateSucess),this.dialogRef.afterClosed().subscribe(()=>{console.log("Di\xE1logo fechado, redirecionando para login"),this.router.navigate(["/login"])})}openDialog(t){this.dialogRef=this.dialog.open(t)}closeDialog(){this.dialog.closeAll(),this.dialogRef&&this.templateSucess&&this.router.navigate(["/login"])}passwordMatchValidator(t){let l=t.get("password")?.value,o=t.get("confirmPassowrd")?.value;return l===o?null:{mismatch:!0}}ngOnDestroy(){this.destroy$.next(""),this.destroy$.complete()}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=V({type:a,selectors:[["app-cadastro"]],viewQuery:function(l,o){if(l&1&&(w(ce,5),w(me,5)),l&2){let c;F(c=S())&&(o.templateSucess=c.first),F(c=S())&&(o.templateError=c.first)}},decls:117,vars:12,consts:[["photo",""],["email",""],["pass",""],["confirm",""],["dialog",""],["dialogError",""],[1,"header"],["src","img/white-logo.png","alt",""],[1,"ui","form",3,"formGroup"],[1,"container-photo"],[1,"photo"],["type","file",3,"change"],["alt","",3,"src"],[1,"select-picture",3,"click"],[1,"camera","icon"],[1,"two","fields"],[1,"field"],[1,"ui","labeled","input"],[1,"ui","label"],["type","text","formControlName","name","placeholder","Nome"],[1,"error-msg"],["type","email","formControlName","email","placeholder","Email"],[1,"ui","inverted","divider"],[1,"three","fields"],["type","text","formControlName","cpf","placeholder","CPF","CpfCnpjMask","","maxlength","14"],[1,"five","wide","field"],["type","text","formControlName","rg","placeholder","RG","maxlength","10"],[1,"eight","wide","field"],["type","date","placeholder","DD/MM/YYYY","formControlName","birthDay"],[1,"six","wide","field"],["type","text","formControlName","matricula","placeholder","Matr\xEDcula (Opcional)"],["type","text","formControlName","vinculo","placeholder","V\xEDnculo"],["type","text","formControlName","lotacao","placeholder","Lota\xE7\xE3o"],["type","text","formControlName","endereco","placeholder","Endere\xE7o"],["type","text","formControlName","phone","placeholder","(DDD) 00000-0000","PhoneMask",""],[1,"ui","labeled","action","input"],["type","password","formControlName","password","placeholder","Senha"],["type","button",1,"ui","icon","button",3,"click"],[1,"eye","icon"],[1,"eye","slash","icon"],["type","password","formControlName","confirmPassowrd","placeholder","Digite sua senha novamente"],[1,"alert"],["type","button",1,"ui","button",3,"routerLink"],["type","button",1,"ui","button","primary",3,"click","disabled"],[1,"dialog-title"],["type","button",1,"ui","button","primary","fluid",3,"click"],[1,""],["type","button",1,"ui","button","primary",3,"click"]],template:function(l,o){if(l&1){let c=P();i(0,"section")(1,"div",6),s(2,"img",7),e(),i(3,"form",8)(4,"div",9)(5,"label"),r(6,"Foto de Perfil"),e(),i(7,"div",10)(8,"input",11,0),v("change",function(n){return _(c),h(o.imgFile(n))}),e(),s(10,"img",12),i(11,"div",13),v("click",function(){_(c);let n=M(9);return h(n.click())}),s(12,"i",14),i(13,"mat-icon"),r(14,"touch_app"),e(),i(15,"p"),r(16,"Selecione uma Foto"),e()()(),u(17,de,2,0,"span"),e(),i(18,"div",15)(19,"div",16)(20,"div",17)(21,"div",18),r(22,"Nome:"),e(),s(23,"input",19),e(),u(24,pe,2,0,"span",20),e(),i(25,"div",16)(26,"div",17)(27,"div",18),r(28,"Email:"),e(),s(29,"input",21,1),e(),u(31,ue,2,0,"span",20),e()(),s(32,"div",22),i(33,"div",23)(34,"div",16)(35,"div",17)(36,"div",18),r(37,"CPF:"),e(),s(38,"input",24),e(),i(39,"span",20),u(40,ge,1,0)(41,fe,1,0),e()(),i(42,"div",25)(43,"div",17)(44,"div",18),r(45,"RG:"),e(),s(46,"input",26),e()(),i(47,"div",27)(48,"div",17)(49,"div",18),r(50,"Data de Nascimento:"),e(),s(51,"input",28),e()()(),i(52,"div",23)(53,"div",29)(54,"div",17)(55,"div",18),r(56,"Matr\xEDcula:"),e(),s(57,"input",30),e()(),i(58,"div",16)(59,"div",17)(60,"div",18),r(61,"V\xEDnculo:"),e(),s(62,"input",31),e()(),i(63,"div",16)(64,"div",17)(65,"div",18),r(66,"Lota\xE7\xE3o:"),e(),s(67,"input",32),e()()(),i(68,"div",15)(69,"div",16)(70,"div",17)(71,"div",18),r(72,"Endere\xE7o:"),e(),s(73,"input",33),e()(),i(74,"div",16)(75,"div",17)(76,"div",18),r(77,"Telefone:"),e(),s(78,"input",34),e()()(),s(79,"div",22),i(80,"div",15)(81,"div",16)(82,"div",35)(83,"div",18),r(84,"Senha:"),e(),s(85,"input",36,2),i(87,"button",37),v("click",function(){_(c);let n=M(86);return h(n.type==="password"?n.type="text":n.type="password")}),u(88,Ce,1,0,"i",38)(89,_e,1,0,"i",39),e()(),i(90,"span",20),u(91,he,1,0)(92,ve,1,0),e()(),i(93,"div",16)(94,"div",35)(95,"div",18),r(96,"Confirme a senha:"),e(),s(97,"input",40,3),i(99,"button",37),v("click",function(){_(c);let n=M(98);return h(n.type==="password"?n.type="text":n.type="password")}),u(100,Me,1,0,"i",38)(101,xe,1,0,"i",39),e()(),i(102,"span",20),u(103,Ee,1,0)(104,Pe,1,0),e()()(),s(105,"div",22),i(106,"div",41)(107,"span"),r(108,"*Verifique se suas informa\xE7\xF5es est\xE3o corretas antes de enviar o formulario !*"),e()(),i(109,"button",42),r(110,"Voltar"),e(),i(111,"button",43),v("click",function(){return _(c),h(o.submitForm())}),r(112,"Cadastrar"),e()()(),u(113,Oe,11,0,"ng-template",null,4,D)(115,be,13,2,"ng-template",null,5,D)}if(l&2){let c,p,n,m,g,le=M(86),se=M(98);d(3),E("formGroup",o.registerForm),d(7),E("src",o.profileImg?o.profileImg:"img/user-profile.png",T),d(7),f(o.profileImg?17:-1),d(7),f((c=o.registerForm.get("name"))!=null&&c.hasError("required")&&((c=o.registerForm.get("name"))!=null&&c.touched)?24:-1),d(7),f((p=o.registerForm.get("email"))!=null&&p.hasError("email")&&((p=o.registerForm.get("email"))!=null&&p.dirty)?31:-1),d(9),f((n=o.registerForm.get("cpf"))!=null&&n.hasError("required")&&((n=o.registerForm.get("cpf"))!=null&&n.touched)?40:(n=o.registerForm.get("cpf"))!=null&&n.hasError("minlength")&&((n=o.registerForm.get("cpf"))!=null&&n.dirty)?41:-1),d(48),f(le.type==="password"?88:89),d(3),f((m=o.registerForm.get("password"))!=null&&m.hasError("required")&&((m=o.registerForm.get("password"))!=null&&m.touched)?91:(m=o.registerForm.get("password"))!=null&&m.hasError("minlength")&&((m=o.registerForm.get("password"))!=null&&m.dirty)?92:-1),d(9),f(se.type==="password"?100:101),d(3),f((g=o.registerForm.get("confirmPassowrd"))!=null&&g.hasError("required")&&((g=o.registerForm.get("confirmPassowrd"))!=null&&g.touched)?103:o.registerForm.hasError("mismatch")&&((g=o.registerForm.get("confirmPassowrd"))!=null&&g.touched)?104:-1),d(6),E("routerLink","/login"),d(2),E("disabled",o.registerForm.invalid)}},dependencies:[B,G,z,q,H,Y,J,Q,U,I,j,A,oe,re,Z,X,ie,ne,te],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;padding:20px;background:url(/img/background.png) no-repeat right;background-size:cover;height:max-content;min-height:100%}.header[_ngcontent-%COMP%]{padding:20px;width:100%;display:flex;justify-content:center;background:linear-gradient(to right,#008cb7d7,#0046b7d7)}.header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px}.dialog-title[_ngcontent-%COMP%]{font-weight:400;padding:20px;font-size:18px}section[_ngcontent-%COMP%]{width:100%;max-width:800px;min-width:355px;background:#dfdfdfa1;border-radius:10px;box-shadow:1px 2px 3px #2c2c2c73;overflow:hidden}section[_ngcontent-%COMP%]   .form-type[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{background:#0046b7d7;color:#fff}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]{padding:10px;width:100%;height:100%;max-width:800px}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:15px;justify-content:center}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#fff;width:160px;background:#0045b7;padding:5px;text-align:center;border-radius:10px 10px 0 0;font-weight:600}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:relative}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:190px;width:160px;object-fit:cover;object-position:center;box-shadow:1px 2px 3px #47474760}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]   .select-picture[_ngcontent-%COMP%]{display:none;height:100%;width:100%;background:#6363635e;flex-direction:column;align-items:center;justify-content:center;position:absolute;color:#fff;cursor:pointer}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]   .select-picture[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:30px}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]   .select-picture[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:none}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]   .select-picture[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:500;font-size:14px}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]:hover   .select-picture[_ngcontent-%COMP%]{display:flex}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .container-photo[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10px}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .fields[_ngcontent-%COMP%]{width:100%}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .fields[_ngcontent-%COMP%]   .ui[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{background:#0046b7d7;color:#fff;min-width:25%}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{padding:10px}section[_ngcontent-%COMP%]   .ui.form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:20px}.error-msg[_ngcontent-%COMP%]{display:flex;width:100%;height:10px;color:red;margin-top:5px;margin-left:10px;font-size:12px}@media only screen and (max-width: 700px){.select-picture[_ngcontent-%COMP%]{display:flex!important}.select-picture[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:none}.select-picture[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:50px;height:50px;font-size:50px}}"]})};export{ae as CadastroComponent};
