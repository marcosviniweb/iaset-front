import{d,i as g}from"./chunk-X4VVONUQ.js";import{q as l,s as c}from"./chunk-6KEO6D2E.js";import{Z as u,c as o,da as n,q as a}from"./chunk-X3WKPGPN.js";var h=class i{router=n(d);httpClient=n(c);apiUrl=g;userData=JSON.parse(localStorage.getItem("userData")||"{}");getAuthToken(){return localStorage.getItem("token")||""}getAuthHeaders(){let t=this.getAuthToken();return new l({"Content-Type":"application/json",Authorization:`Bearer ${t}`})}auth(t){return o(this,null,function*(){return console.log("Tentando login com:",t),a(this.httpClient.post(this.apiUrl.auth,t)).then(r=>(console.log("Resposta de login:",r),this.userData=r.user,localStorage.setItem("userData",JSON.stringify(r.user)),localStorage.setItem("token",r.access_token),r.user.firstAccess?this.router.navigate(["/primeiro-acesso"]):this.router.navigate(["/"]),r.user)).catch(r=>{throw console.error("Erro no login:",r),r.status===403?{error:{message:"Seu acesso ainda n\xE3o foi aprovado. Aguarde a aprova\xE7\xE3o."},status:403}:r})})}logOff(){localStorage.clear(),this.router.navigate(["/login"])}passwordChange(t){return o(this,null,function*(){let r=this.getAuthHeaders();if(console.log("Alterando senha para o usu\xE1rio:",this.userData.id),console.log("Dados enviados:",JSON.stringify(t)),!this.userData||!this.userData.id)throw console.error("Erro: userData ou userData.id n\xE3o est\xE1 definido"),{error:{message:"Dados de usu\xE1rio n\xE3o encontrados. Fa\xE7a login novamente."},status:401};try{let e=`${this.apiUrl.dataUser}/${this.userData.id}/password`;console.log("URL da requisi\xE7\xE3o:",e),console.log("Headers:",r);let s=yield a(this.httpClient.put(e,t,{headers:r}));return console.log("Resposta de altera\xE7\xE3o de senha:",s),s}catch(e){throw console.error("Erro ao alterar senha:",e),console.error("Status do erro:",e.status),console.error("Mensagem do erro:",e.error),e.status===400&&e.error?.message?.includes("antiga incorreta")?{error:{message:"Senha atual incorreta. Verifique e tente novamente."},status:400}:e.status===400&&e.error?.message?.includes("n\xE3o pode ser igual")?{error:{message:"A nova senha n\xE3o pode ser igual \xE0 senha atual."},status:400}:e}})}changeFirstAccess(t){return o(this,null,function*(){let r=this.getAuthHeaders();if(console.log("Atualizando status de primeiro acesso para o usu\xE1rio:",this.userData.id),console.log("Dados enviados:",JSON.stringify(t)),!this.userData||!this.userData.id)throw console.error("Erro: userData ou userData.id n\xE3o est\xE1 definido"),{error:{message:"Dados de usu\xE1rio n\xE3o encontrados. Fa\xE7a login novamente."},status:401};try{let e=`${this.apiUrl.dataUser}/${this.userData.id}/first-access`;console.log("URL da requisi\xE7\xE3o:",e),console.log("Headers:",r);let s=yield a(this.httpClient.put(e,t,{headers:r}));return console.log("Resposta de atualiza\xE7\xE3o de primeiro acesso:",s),this.userData.firstAccess=t.firstAccess,localStorage.setItem("userData",JSON.stringify(this.userData)),s}catch(e){throw console.error("Erro ao atualizar status de primeiro acesso:",e),console.error("Status do erro:",e.status),console.error("Mensagem do erro:",e.error),e}})}static \u0275fac=function(r){return new(r||i)};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};export{h as a};
